<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Chief of Staff</title>
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https://unpkg.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' ws://127.0.0.1:8787;">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Load custom fonts -->
  <link rel="stylesheet" href="assets/fonts/fonts.css?v=8">
  <link rel="stylesheet" href="design/modern-tokens.css?v=8">
  
  <!-- Load React and Babel for development -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Load URL formatting utilities -->
  <script src="utils/url-formatter.js"></script>
  
  <style id="app-styles">
    /* Settings-based CSS will be loaded dynamically */
  </style>
  
  <script>
    // Load settings and generate CSS
    fetch('./design/settings.json')
      .then(response => response.json())
      .then(settings => {
        const theme = settings.theme;
        let css = ':root {\n';
        
        // Colors
        css += `  --bg-primary: ${theme.colors.background.primary};\n`;
        css += `  --bg-secondary: ${theme.colors.background.secondary};\n`;
        css += `  --bg-tertiary: ${theme.colors.background.tertiary};\n`;
        css += `  --surface-base: ${theme.colors.surface.default};\n`;
        css += `  --surface-hover: ${theme.colors.surface.hover};\n`;
        css += `  --surface-active: ${theme.colors.surface.active};\n`;
        css += `  --text-primary: ${theme.colors.text.primary};\n`;
        css += `  --text-secondary: ${theme.colors.text.secondary};\n`;
        css += `  --text-muted: ${theme.colors.text.muted};\n`;
        css += `  --text-disabled: ${theme.colors.text.disabled};\n`;
        css += `  --border-base: ${theme.colors.border.default};\n`;
        css += `  --border-hover: ${theme.colors.border.hover};\n`;
        css += `  --border-focus: ${theme.colors.border.focus};\n`;
        css += `  --brand-primary: ${theme.colors.brand.primary};\n`;
        css += `  --brand-hover: ${theme.colors.brand.hover};\n`;
        css += `  --brand-active: ${theme.colors.brand.active};\n`;
        css += `  --success: ${theme.colors.status.success};\n`;
        css += `  --success-bg: ${theme.colors.status.successBg};\n`;
        css += `  --warning: ${theme.colors.status.warning};\n`;
        css += `  --warning-bg: ${theme.colors.status.warningBg};\n`;
        css += `  --error: ${theme.colors.status.error};\n`;
        css += `  --error-bg: ${theme.colors.status.errorBg};\n`;
        css += `  --info: ${theme.colors.status.info};\n`;
        css += `  --info-bg: ${theme.colors.status.infoBg};\n`;
        css += `  --link-primary: ${theme.colors.link.primary};\n`;
        css += `  --link-hover: ${theme.colors.link.hover};\n`;
        css += `  --link-visited: ${theme.colors.link.visited};\n`;
        css += `  --link-underline: ${theme.colors.link.underlineColor};\n`;
        
        // Typography  
        css += `  --font-family: ${theme.typography.fontFamily};\n`;
        css += `  --font-display: ${theme.typography.fontDisplay};\n`;
        css += `  --font-mono: ${theme.typography.fontMono};\n`;
        css += `  --font-size-xs: ${theme.typography.fontSize.xs};\n`;
        css += `  --font-size-sm: ${theme.typography.fontSize.sm};\n`;
        css += `  --font-size-base: ${theme.typography.fontSize.base};\n`;
        css += `  --font-size-lg: ${theme.typography.fontSize.lg};\n`;
        css += `  --font-size-xl: ${theme.typography.fontSize.xl};\n`;
        css += `  --font-size-2xl: ${theme.typography.fontSize['2xl']};\n`;
        css += `  --font-size-3xl: ${theme.typography.fontSize['3xl']};\n`;
        css += `  --font-weight-normal: ${theme.typography.fontWeight.normal};\n`;
        css += `  --font-weight-medium: ${theme.typography.fontWeight.medium};\n`;
        css += `  --font-weight-semibold: ${theme.typography.fontWeight.semibold};\n`;
        css += `  --font-weight-bold: ${theme.typography.fontWeight.bold};\n`;
        css += `  --line-height-tight: ${theme.typography.lineHeight.tight};\n`;
        css += `  --line-height-base: ${theme.typography.lineHeight.base};\n`;
        css += `  --line-height-relaxed: ${theme.typography.lineHeight.relaxed};\n`;
        
        // Spacing
        Object.entries(theme.spacing).forEach(([key, value]) => {
          css += `  --space-${key}: ${value};\n`;
        });
        
        // Border radius
        Object.entries(theme.borderRadius).forEach(([key, value]) => {
          css += `  --radius-${key}: ${value};\n`;
        });
        
        // Shadows
        Object.entries(theme.shadows).forEach(([key, value]) => {
          css += `  --shadow-${key}: ${value};\n`;
        });
        
        // Transitions
        css += `  --duration-fast: ${theme.transitions.fast};\n`;
        css += `  --duration-base: ${theme.transitions.base};\n`;
        css += `  --duration-slow: ${theme.transitions.slow};\n`;
        css += `  --ease: ${theme.transitions.ease};\n`;
        
        // Layout
        css += `  --sidebar-width: ${settings.layout.sidebar.width};\n`;
        css += `  --chatbox-width: ${settings.layout.chatbox.width};\n`;
        
        css += '}\n';
        
        // Apply the generated CSS
        document.getElementById('app-styles').innerHTML = css;
      })
      .catch(err => console.warn('Failed to load settings.json, using default styles'));
  </script>
  
  <style>
    
    /* Base Styles */
    * { box-sizing: border-box; }
    
    html, body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      font-size: var(--font-size-base);
      line-height: var(--line-height-base);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-weight: var(--font-weight-normal);
    }
    
    /* Layout */
    .app-layout {
      display: grid;
      grid-template-columns: var(--sidebar-width) var(--chatbox-width) 1fr;
      grid-template-rows: 1fr auto;
      height: 100vh;
      background: var(--bg-primary);
    }

    /* Status bar */
    .status-bar {
      grid-column: 1 / -1;
      background: var(--surface-base);
      border-top: 1px solid var(--border-base);
      padding: var(--space-2) var(--space-4);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      box-shadow: var(--shadow-lg);
      z-index: 10;
    }

    .status-indicators {
      display: flex;
      gap: var(--space-6);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-dot.connected { background: var(--success); }
    .status-dot.connecting { background: var(--warning); }
    .status-dot.disconnected { background: var(--error); }

    .status-text {
      font-family: var(--font-mono);
      font-size: var(--font-size-xs);
    }

    .status-text.connected { color: var(--success); }
    .status-text.connecting { color: var(--warning); }
    .status-text.disconnected { color: var(--error); }

    /* Left icon sidebar */
    .icon-sidebar {
      background: var(--surface-base);
      border-right: 1px solid var(--border-base);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: var(--space-4) var(--space-2);
      box-shadow: var(--shadow-base);
    }

    .icon-nav {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }

    .icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      border: none;
      border-radius: var(--radius-lg);
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--duration-fast) var(--duration-ease);
      font-family: var(--font-display);
    }

    .icon-btn:hover {
      background: var(--surface-hover);
      color: var(--text-primary);
    }

    .icon-btn.active {
      background: var(--brand-primary);
      color: white;
    }

    /* Main content area */
    .main-area {
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .main-content {
      flex: 1;
      padding: var(--space-8);
      overflow-y: auto;
    }

    .placeholder-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
    }

    /* Right chatbox panel */
    .chatbox-panel {
      background: var(--surface-base);
      border-left: 1px solid var(--border-base);
      box-shadow: var(--shadow-lg);
    }

    .chatbox {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .chatbox-header {
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-base);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .connection-indicator {
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .connection-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .connection-dot.connected { background: var(--success); }
    .connection-dot.connecting { background: var(--warning); }
    .connection-dot.disconnected { background: var(--error); }

    .messages-area {
      flex: 1;
      padding: var(--space-4);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .welcome-message {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: var(--space-8) var(--space-4);
    }

    .welcome-icon {
      font-size: 3rem;
      margin-bottom: var(--space-4);
    }

    .quick-commands {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
      width: 100%;
    }

    .quick-cmd-btn {
      padding: var(--space-2) var(--space-3);
      background: var(--bg-tertiary);
      border: 1px solid var(--border-base);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--duration-fast) var(--duration-ease);
      font-family: var(--font-display);
      font-size: var(--font-size-sm);
      color: var(--brand-primary);
    }

    .quick-cmd-btn:hover {
      background: var(--surface-hover);
      border-color: var(--brand-primary);
    }

    .input-area {
      padding: var(--space-4);
      border-top: 1px solid var(--border-base);
    }

    .input-wrapper {
      display: flex;
      gap: var(--space-2);
    }

    .chat-input {
      flex: 1;
      padding: var(--space-3);
      border: 1px solid var(--border-base);
      border-radius: var(--radius-lg);
      background: var(--bg-primary);
      font-size: var(--font-size-sm);
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
    }

    .send-btn {
      padding: var(--space-3);
      background: var(--brand-primary);
      color: white;
      border: none;
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all var(--duration-fast) var(--duration-ease);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-display);
    }

    .send-btn:hover:not(:disabled) {
      background: var(--brand-hover);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Chat Message Bubbles */
    .message {
      margin-bottom: var(--space-4);
      display: flex;
      flex-direction: column;
    }
    
    .message.user {
      align-items: flex-end;
    }
    
    .message.agent {
      align-items: flex-start;
    }
    
    .message-content {
      max-width: 80%;
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-lg);
      font-family: var(--font-family);
      font-size: var(--font-size-sm);
      line-height: var(--line-height-base);
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    
    .message.user .message-content {
      background: var(--brand-primary);
      color: white;
      border-bottom-right-radius: var(--radius-sm);
    }
    
    .message.agent .message-content {
      background: var(--surface-base);
      color: var(--text-primary);
      border: 1px solid var(--border-base);
      border-bottom-left-radius: var(--radius-sm);
      box-shadow: var(--shadow-sm);
    }
    
    .message-time {
      font-size: var(--font-size-xs);
      color: var(--text-muted);
      margin-top: var(--space-1);
      font-family: var(--font-display);
    }
    
    .message.user .message-time {
      text-align: right;
    }
    
    .message.agent .message-time {
      text-align: left;
    }
    
    /* Typing indicator */
    .message.typing .message-content::after {
      content: '|';
      animation: blink 1s infinite;
      margin-left: 2px;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    /* Thinking indicator */
    .message.thinking-indicator {
      align-items: flex-start;
      margin-bottom: var(--space-2);
    }
    
    .message.thinking-indicator .message-content {
      background: transparent;
      color: var(--text-muted);
      border: none;
      box-shadow: none;
      font-style: italic;
      font-size: var(--font-size-sm);
      padding: var(--space-2) var(--space-3);
      animation: fade-pulse 1.5s ease-in-out infinite alternate;
    }
    
    @keyframes fade-pulse {
      0% { opacity: 0.6; }
      100% { opacity: 1; }
    }
    
    /* Headings use display font */
    h1, h2, h3, h4, h5, h6 {
      font-family: var(--font-display);
    }
    
    /* Utility classes */
    .text-2xl { font-size: var(--font-size-2xl); }
    .font-semibold { font-weight: var(--font-weight-semibold); }
    .font-medium { font-weight: var(--font-weight-medium); }
    .text-muted { color: var(--text-muted); }
    .text-sm { color: var(--text-secondary); }
    .mb-4 { margin-bottom: var(--space-4); }
    .mb-2 { margin-bottom: var(--space-2); }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // URL Formatting Component
    const FormattedText = ({ text, linkText = "here", className = "" }) => {
      const [formattedHtml, setFormattedHtml] = useState('');
      
      useEffect(() => {
        if (typeof window.UrlFormatter !== 'undefined') {
          window.UrlFormatter.formatUrlsInText(text, linkText)
            .then(html => setFormattedHtml(html))
            .catch(() => setFormattedHtml(text)); // Fallback to original text
        } else {
          setFormattedHtml(text);
        }
      }, [text, linkText]);
      
      return React.createElement('div', {
        className: `formatted-text ${className}`,
        dangerouslySetInnerHTML: { __html: formattedHtml }
      });
    };
    
    // URL Link Component (for single URLs)  
    const UrlLink = ({ url, children, className = "" }) => {
      const linkStyle = {
        color: 'var(--link-primary)',
        textDecoration: 'underline',
        textDecorationColor: 'var(--link-underline)',
        cursor: 'pointer',
        transition: 'color 0.2s ease'
      };
      
      const handleMouseOver = (e) => {
        e.target.style.color = 'var(--link-hover)';
      };
      
      const handleMouseOut = (e) => {
        e.target.style.color = 'var(--link-primary)';
      };
      
      return React.createElement('a', {
        href: url,
        target: '_blank',
        rel: 'noopener noreferrer',
        className: `url-link ${className}`,
        style: linkStyle,
        onMouseOver: handleMouseOver,
        onMouseOut: handleMouseOut
      }, children || '[here]');
    };
    
    function App() {
      const [activeSection, setActiveSection] = useState("main");
      const [connectionStatus, setConnectionStatus] = useState('connecting');
      const [aiStatus, setAiStatus] = useState({ status: 'unknown', provider: 'Anthropic', model: 'Claude-3.5-Sonnet' });
      const [outlookStatus, setOutlookStatus] = useState({ status: 'disconnected', method: null });
      const [messages, setMessages] = useState([]);
      const [inputText, setInputText] = useState("");
      const messagesEndRef = useRef(null);
      const wsRef = useRef(null);

      useEffect(() => {
        const ws = new WebSocket("ws://127.0.0.1:8787/ws");
        wsRef.current = ws;
        
        ws.onopen = () => {
          setConnectionStatus('connected');
          // Request initial status
          ws.send(JSON.stringify({ event: 'status:request' }));
        };
        ws.onclose = () => setConnectionStatus('disconnected');
        ws.onerror = () => setConnectionStatus('disconnected');
        
        ws.onmessage = (event) => {
          try {
            const message = JSON.parse(event.data);
            
            // Handle status updates
            if (message.event === 'status:ai') {
              console.log('Received AI status:', message.data);
              setAiStatus(message.data);
            } else if (message.event === 'status:outlook') {
              console.log('Received Outlook status:', message.data);
              setOutlookStatus(message.data);
            } else if (message.event === 'thread:append') {
              const newMessage = message.data.message;
              if (newMessage.role === 'agent') {
                // AI is working, update status
                setAiStatus(prev => ({ ...prev, status: 'connected' }));
                
                // Remove thinking indicator and add AI message
                setMessages(prev => {
                  // Filter out thinking indicators
                  const withoutThinking = prev.filter(msg => !msg.isThinking);
                  // Add AI message with timestamp
                  const messageWithTimestamp = { 
                    ...newMessage, 
                    content: '', 
                    isTyping: true,
                    timestamp: new Date().toLocaleTimeString()
                  };
                  return [...withoutThinking, messageWithTimestamp];
                });
                
                // Start typewriter effect
                setTimeout(() => {
                  startTypewriter(newMessage.content, newMessage.id);
                }, 100);
              } else {
                setMessages(prev => [...prev, newMessage]);
              }
            }
          } catch (e) {
            console.error('Error parsing message:', e);
          }
        };
        
        return () => {
          wsRef.current = null;
          ws.close();
        };
      }, []);

      // Periodic status checking
      useEffect(() => {
        const statusInterval = setInterval(() => {
          if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {
            console.log('Sending status request...');
            wsRef.current.send(JSON.stringify({ event: 'status:request' }));
          } else {
            console.log('WebSocket not ready for status request');
          }
        }, 10000); // Check every 10 seconds

        return () => clearInterval(statusInterval);
      }, []);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      const startTypewriter = (fullText, messageId) => {
        let currentIndex = 0;
        const typeSpeed = 15; // milliseconds per character (faster)
        
        const typeInterval = setInterval(() => {
          if (currentIndex <= fullText.length) {
            const partialText = fullText.substring(0, currentIndex);
            setMessages(prev => 
              prev.map(msg => 
                msg.id === messageId 
                  ? { ...msg, content: partialText, isTyping: currentIndex < fullText.length }
                  : msg
              )
            );
            currentIndex++;
          } else {
            clearInterval(typeInterval);
          }
        }, typeSpeed);
      };

      const sendMessage = () => {
        if (!inputText.trim() || connectionStatus !== 'connected' || !wsRef.current) return;
        
        const userMessage = {
          id: Date.now(),
          role: 'user',
          content: inputText,
          timestamp: new Date().toLocaleTimeString()
        };
        
        // Add user message to UI immediately
        setMessages(prev => [...prev, userMessage]);
        
        // Add thinking indicator
        const thinkingMessage = {
          id: 'thinking-' + Date.now(),
          role: 'thinking-indicator',
          content: 'Thinking...',
          isThinking: true
        };
        setMessages(prev => [...prev, thinkingMessage]);
        
        // Send message to backend via WebSocket
        const messageData = {
          event: 'thread:send',
          data: {
            text: inputText,
            timestamp: new Date().toISOString()
          }
        };
        
        wsRef.current.send(JSON.stringify(messageData));
        setInputText("");
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      };

      // Status bar component
      const StatusBar = () => {
        const formatAiStatus = () => {
          if (aiStatus.status === 'connected') {
            return `${aiStatus.provider} | ${aiStatus.model}`;
          } else if (aiStatus.status === 'connecting') {
            return `${aiStatus.provider} | Connecting...`;
          } else {
            return `${aiStatus.provider} | Disconnected`;
          }
        };

        const formatOutlookStatus = () => {
          if (outlookStatus.status === 'connected' && outlookStatus.method) {
            return `Outlook:${outlookStatus.method.toUpperCase()}`;
          } else if (outlookStatus.status === 'connecting') {
            return 'Outlook:Connecting...';
          } else {
            return 'Outlook:Disconnected';
          }
        };

        return React.createElement('div', { className: 'status-bar' },
          React.createElement('div', { className: 'status-indicators' },
            // AI Status
            React.createElement('div', { className: 'status-indicator' },
              React.createElement('div', { 
                className: `status-dot ${aiStatus.status}`,
                title: `AI Status: ${aiStatus.status}`
              }),
              React.createElement('span', { 
                className: `status-text ${aiStatus.status}` 
              }, formatAiStatus())
            ),
            // Outlook Status  
            React.createElement('div', { className: 'status-indicator' },
              React.createElement('div', { 
                className: `status-dot ${outlookStatus.status}`,
                title: `Outlook Status: ${outlookStatus.status}`
              }),
              React.createElement('span', { 
                className: `status-text ${outlookStatus.status}` 
              }, formatOutlookStatus())
            )
          ),
          React.createElement('div', { className: 'status-info' },
            React.createElement('span', { className: 'text-muted' }, 
              `Backend ${connectionStatus}`
            )
          )
        );
      };

      return React.createElement('div', { className: 'app-layout' },
        // Left icon panel
        React.createElement('aside', { className: 'icon-sidebar' },
          React.createElement('div', { className: 'icon-nav' },
            React.createElement('button', {
              className: `icon-btn ${activeSection === 'main' ? 'active' : ''}`,
              onClick: () => setActiveSection('main'),
              title: 'Main'
            },
              React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                React.createElement('path', { d: 'M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z' }),
                React.createElement('polyline', { points: '9,22 9,12 15,12 15,22' })
              )
            ),
            React.createElement('button', {
              className: `icon-btn ${activeSection === 'emails' ? 'active' : ''}`,
              onClick: () => setActiveSection('emails'),
              title: 'Emails'
            },
              React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                React.createElement('path', { d: 'M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z' }),
                React.createElement('polyline', { points: '22,6 12,13 2,6' })
              )
            )
          )
        ),
        
        // Chatbox panel (moved to center)
        React.createElement('aside', { className: 'chatbox-panel' },
          React.createElement('div', { className: 'chatbox' },
            // Header
            React.createElement('div', { className: 'chatbox-header' },
              React.createElement('h3', { className: 'font-semibold' }, 'Chief of Staff'),
              React.createElement('div', { className: 'connection-indicator' },
                React.createElement('div', {
                  className: `connection-dot ${connectionStatus}`,
                  title: `Backend ${connectionStatus}`
                }),
                React.createElement('span', { className: 'text-sm text-muted' }, connectionStatus)
              )
            ),
            
            // Messages area
            React.createElement('div', { className: 'messages-area' },
              messages.length === 0 ? (
                React.createElement('div', { className: 'welcome-message' },
                  React.createElement('div', { className: 'welcome-icon' }, 'ðŸ“‹'),
                  React.createElement('h4', { className: 'font-medium mb-2' }, 'Welcome to Chief of Staff'),
                  React.createElement('p', { className: 'text-sm text-muted mb-4' }, 
                    'Your intelligent productivity assistant. I can help you plan your day, organize your emails, manage projects, and much more. Just ask me anything!'
                  ),
                  React.createElement('div', { className: 'quick-commands' },
                    ['Help me plan my day', 'What\'s in my inbox?', 'Show me my current projects'].map(suggestion =>
                      React.createElement('button', {
                        key: suggestion,
                        className: 'quick-cmd-btn',
                        onClick: () => setInputText(suggestion)
                      }, suggestion)
                    )
                  )
                )
              ) : (
                messages.map((msg, idx) =>
                  React.createElement('div', { 
                    key: idx, 
                    className: `message ${msg.role} ${msg.isTyping ? 'typing' : ''}`
                  },
                    msg.role === 'agent' 
                      ? React.createElement(FormattedText, { text: msg.content, className: 'message-content' })
                      : React.createElement('div', { className: 'message-content' }, msg.content),
                    msg.timestamp && React.createElement('div', { className: 'message-time' }, msg.timestamp)
                  )
                )
              ),
              React.createElement('div', { ref: messagesEndRef })
            ),
            
            // Input area
            React.createElement('div', { className: 'input-area' },
              React.createElement('div', { className: 'input-wrapper' },
                React.createElement('input', {
                  className: 'chat-input',
                  placeholder: 'What can I help you with today?',
                  value: inputText,
                  onChange: (e) => setInputText(e.target.value),
                  onKeyPress: handleKeyPress,
                  disabled: connectionStatus !== 'connected'
                }),
                React.createElement('button', {
                  className: 'send-btn',
                  onClick: sendMessage,
                  disabled: !inputText.trim() || connectionStatus !== 'connected'
                },
                  React.createElement('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                    React.createElement('line', { x1: 22, y1: 2, x2: 11, y2: 13 }),
                    React.createElement('polygon', { points: '22,2 15,22 11,13 2,9 22,2' })
                  )
                )
              )
            )
          )
        ),
        
        // Main content area (moved to right)
        React.createElement('main', { className: 'main-area' },
          React.createElement('div', { className: 'main-content' },
            React.createElement('div', { className: 'placeholder-content' },
              React.createElement('h2', { className: 'text-2xl font-semibold text-muted mb-4' },
                activeSection === 'main' ? 'Main Dashboard' : 'Email Management'
              ),
              React.createElement('p', { className: 'text-muted' },
                'This area is reserved for future content.'
              )
            )
          )
        ),
        
        // Status bar at bottom
        React.createElement(StatusBar)
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>